# Web App é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆapps/webï¼‰å°‚ç”¨ã®é–‹ç™ºç’°å¢ƒæ§‹ç¯‰ã‚¬ã‚¤ãƒ‰ã§ã™ã€‚

## ğŸš€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### ğŸ³ Dockerç’°å¢ƒï¼ˆæ¨å¥¨ï¼‰- Jest Workerã‚¨ãƒ©ãƒ¼å®Œå…¨è§£æ±ºæ¸ˆã¿

#### 1. åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆæ¨å¥¨: æ®µéšçš„å®Ÿè¡Œï¼‰
```bash
# webã‚¢ãƒ—ãƒªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•
cd apps/web

# 1. Dockerç’°å¢ƒã§ãƒ“ãƒ«ãƒ‰ & èµ·å‹•ï¼ˆè‡ªå‹•ã§DBèµ·å‹•ï¼‹ã‚¢ãƒ—ãƒªèµ·å‹•ï¼‰
yarn docker:up --build
# ã¾ãŸã¯æ®µéšçš„ã«
yarn docker:build
yarn docker:up
```

#### 2. æ—¥å¸¸çš„ãªé–‹ç™ºï¼ˆDockerï¼‰
```bash
# Dockerç’°å¢ƒèµ·å‹•ï¼ˆæœ€é€Ÿï¼‰
yarn docker:up

# Dockerç’°å¢ƒèµ·å‹•ï¼ˆãƒªãƒ“ãƒ«ãƒ‰ä»˜ãï¼‰
yarn docker:dev
```

#### 3. Dockerç’°å¢ƒã®æ“ä½œ
```bash
# ãƒ­ã‚°ç¢ºèª
yarn docker:logs

# ã‚³ãƒ³ãƒ†ãƒŠã«ã‚·ã‚§ãƒ«æ¥ç¶š
yarn docker:shell

# ç’°å¢ƒåœæ­¢
yarn docker:down

# å®Œå…¨ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
yarn docker:clean
```

**ğŸ’¡ Dockerç’°å¢ƒã®åˆ©ç‚¹:**
- âœ… Jest Worker ã‚¨ãƒ©ãƒ¼ãŒå®Œå…¨è§£æ±ºï¼ˆNode.js 22.6.0 + Alpine Linuxï¼‰
- âœ… ç’°å¢ƒã®çµ±ä¸€æ€§ï¼ˆWindows/Mac/Linux å•ã‚ãšåŒã˜ç’°å¢ƒï¼‰
- âœ… ä¾å­˜é–¢ä¿‚ã®åˆ†é›¢
- âœ… ãƒ¯ãƒ³ã‚³ãƒãƒ³ãƒ‰ã§èµ·å‹•

### ğŸ“¦ å¾“æ¥ã®ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒ
```bash
# webã‚¢ãƒ—ãƒªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•
cd apps/web

# 1. ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
yarn install

# 2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹èµ·å‹•
yarn db:start

# 3. Prismaã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç”Ÿæˆï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹èµ·å‹•å¾Œï¼‰
yarn db:generate

# 4. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
yarn db:migrate

# 5. é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•
yarn dev
```

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ http://localhost:3000 ã§èµ·å‹•ã—ã¾ã™ã€‚

## ğŸŒ± ä»®ãƒ‡ãƒ¼ã‚¿æŠ•å…¥

ãƒ‡ã‚¶ã‚¤ãƒ³ç¢ºèªç”¨ã®ä»®ãƒ‡ãƒ¼ã‚¿ã‚’æŠ•å…¥ã§ãã¾ã™ï¼š

### Dockerç’°å¢ƒã®å ´åˆ
```bash
# Dockerç’°å¢ƒå†…ã§ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œï¼ˆPrismaã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒåˆ©ç”¨å¯èƒ½ã«ãªã£ãŸå ´åˆï¼‰
yarn docker:shell
# ã‚³ãƒ³ãƒ†ãƒŠå†…ã§ï¼š
yarn db:seed
yarn db:reset-with-seed
```

### ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã®å ´åˆ
```bash
# ä»®ãƒ‡ãƒ¼ã‚¿ã®ã¿æŠ•å…¥
yarn db:seed

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¦ä»®ãƒ‡ãƒ¼ã‚¿æŠ•å…¥ï¼ˆæ¨å¥¨ï¼‰
yarn db:reset-with-seed
```

### æŠ•å…¥ã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿
- **åº—èˆ—**: 5åº—èˆ—ï¼ˆæ±äº¬ã€å¤§é˜ªã€åå¤å±‹ã€æ¨ªæµœã€ç¦å²¡ï¼‰
- **ã‚»ãƒ©ãƒ”ã‚¹ãƒˆ**: 10åï¼ˆãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒã€è©•ä¾¡ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä»˜ãï¼‰
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼**: 5å
- **ã‚³ãƒ¡ãƒ³ãƒˆ**: 30ä»¶
- **ä½“é¨“æ—¥è¨˜**: 10ä»¶
- **ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯**: æœ€å¤§15ä»¶

## ğŸ“‹ åˆ©ç”¨å¯èƒ½ãªã‚³ãƒãƒ³ãƒ‰

### ğŸ³ Dockerç’°å¢ƒï¼ˆæ¨å¥¨ï¼‰
```bash
# Dockerç’°å¢ƒç®¡ç†
yarn docker:build          # Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰
yarn docker:up              # ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•ï¼ˆãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ï¼‰
yarn docker:up:detached     # ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•ï¼ˆãƒ‡ã‚¿ãƒƒãƒãƒ¢ãƒ¼ãƒ‰ï¼‰
yarn docker:down            # ã‚³ãƒ³ãƒ†ãƒŠåœæ­¢ãƒ»å‰Šé™¤
yarn docker:restart         # ã‚³ãƒ³ãƒ†ãƒŠå†èµ·å‹•
yarn docker:dev             # ãƒ“ãƒ«ãƒ‰ï¼†èµ·å‹•ï¼ˆé–‹ç™ºç”¨ï¼‰
yarn docker:logs            # ã‚³ãƒ³ãƒ†ãƒŠãƒ­ã‚°ã‚’è¡¨ç¤º
yarn docker:shell           # ã‚³ãƒ³ãƒ†ãƒŠã«ã‚·ã‚§ãƒ«æ¥ç¶š
yarn docker:clean           # å®Œå…¨ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼ˆãƒœãƒªãƒ¥ãƒ¼ãƒ å‰Šé™¤ï¼‰

# é–‹ç™ºç”¨ï¼ˆDockerç’°å¢ƒå†…ã§å®Ÿè¡Œï¼‰
yarn dev                    # é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•ï¼ˆport 3000ï¼‰
yarn build                  # ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ãƒ“ãƒ«ãƒ‰  
yarn lint                   # ESLintå®Ÿè¡Œ
yarn lint:fix               # ESLintè‡ªå‹•ä¿®æ­£
```

### ğŸ“¦ ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒï¼ˆå¾“æ¥ï¼‰
```bash
# é–‹ç™ºç”¨
yarn dev                    # é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•ï¼ˆport 3000ï¼‰
yarn build                  # ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ãƒ“ãƒ«ãƒ‰
yarn lint                   # ESLintå®Ÿè¡Œ
yarn lint:fix               # ESLintè‡ªå‹•ä¿®æ­£

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç®¡ç†
yarn db:start               # PostgreSQLãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹èµ·å‹•
yarn db:stop                # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åœæ­¢
yarn db:reset               # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒªã‚»ãƒƒãƒˆï¼ˆå…¨ãƒ‡ãƒ¼ã‚¿å‰Šé™¤ï¼‰
yarn db:generate            # Prismaã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç”Ÿæˆ
yarn db:migrate             # ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
yarn db:studio              # Prisma Studioèµ·å‹•ï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹GUIï¼‰
yarn db:seed                # ä»®ãƒ‡ãƒ¼ã‚¿æŠ•å…¥
yarn db:reset-with-seed     # ãƒªã‚»ãƒƒãƒˆï¼‹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‹ä»®ãƒ‡ãƒ¼ã‚¿æŠ•å…¥

# ã‚·ã‚¹ãƒ†ãƒ 
yarn setup:manual           # ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †è¡¨ç¤º
```

## ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹æˆ

webã‚¢ãƒ—ãƒªã¯2ã¤ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½¿ç”¨ï¼š
- **media-db**: ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼ˆSerapistarã€Commentã€Bookmarkãªã©ï¼‰
- **company-db**: ä¼šç¤¾ãƒ»äºˆç´„ãƒ‡ãƒ¼ã‚¿ï¼ˆCompanyã€ReservationDataãªã©ï¼‰

## ğŸ”§ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### Dockerç’°å¢ƒã®ãƒˆãƒ©ãƒ–ãƒ«

#### ã‚³ãƒ³ãƒ†ãƒŠãŒèµ·å‹•ã—ãªã„
```bash
# Dockerç’°å¢ƒã®çŠ¶æ…‹ç¢ºèª
docker ps -a

# ãƒ­ã‚°ç¢ºèª
yarn docker:logs

# å®Œå…¨ãƒªã‚»ãƒƒãƒˆ
yarn docker:clean
yarn docker:dev
```

#### Jest Worker ã‚¨ãƒ©ãƒ¼ (è§£æ±ºæ¸ˆã¿)
```bash
# Dockerç’°å¢ƒã§ã¯å®Œå…¨ã«è§£æ±ºæ¸ˆã¿ã§ã™
# ã‚‚ã—ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ç™ºç”Ÿã—ãŸå ´åˆã¯ã€Dockerç’°å¢ƒã«åˆ‡ã‚Šæ›¿ãˆã¦ãã ã•ã„
yarn docker:dev
```

### ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã®ãƒˆãƒ©ãƒ–ãƒ«

#### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚¨ãƒ©ãƒ¼
```bash
# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®çŠ¶æ…‹ç¢ºèª
docker ps

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒªã‚»ãƒƒãƒˆ
yarn db:reset

# å†ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
yarn setup:manual
```

#### Prismaã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¨ãƒ©ãƒ¼
```bash
# ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå†ç”Ÿæˆ
yarn db:generate
```

#### ãƒãƒ¼ãƒˆå æœ‰ã‚¨ãƒ©ãƒ¼
```bash
# Windows ã®å ´åˆ
yarn port:check
yarn port:kill

# Mac/Linux ã®å ´åˆ
lsof -i :3000
kill -9 <PID>
```

## ğŸ“ é–‹ç™ºãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
apps/web/
â”œâ”€â”€ app/                    # Next.js App Router
â”œâ”€â”€ components/             # å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ prisma.ts          # media-db Prismaã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆãƒ¢ãƒƒã‚¯å¯¾å¿œæ¸ˆã¿ï¼‰
â”‚   â””â”€â”€ company-prisma.ts  # company-db Prismaã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆãƒ¢ãƒƒã‚¯å¯¾å¿œæ¸ˆã¿ï¼‰
â”œâ”€â”€ .env.local             # ç’°å¢ƒå¤‰æ•°
â”œâ”€â”€ .env.development       # Dockerç’°å¢ƒç”¨è¨­å®š
â”œâ”€â”€ Dockerfile             # Dockerç’°å¢ƒè¨­å®šï¼ˆNode.js 22.6.0ï¼‰
â”œâ”€â”€ docker-compose.dev.yml # é–‹ç™ºç”¨Dockerç’°å¢ƒ
â”œâ”€â”€ .dockerignore          # Dockeré™¤å¤–ãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ package.json           # Yarn + Docker ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â””â”€â”€ yarn.lock              # Yarnä¾å­˜é–¢ä¿‚ãƒ­ãƒƒã‚¯
```

## ğŸ¯ é–‹ç™ºã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### Dockerç’°å¢ƒï¼ˆæ¨å¥¨ï¼‰
1. **ç°¡å˜èµ·å‹•**: `yarn docker:dev` ã§ãƒ¯ãƒ³ã‚³ãƒãƒ³ãƒ‰èµ·å‹•
2. **ç’°å¢ƒçµ±ä¸€**: Node.js 22.6.0 + Alpine Linux ã§ Jest Worker ã‚¨ãƒ©ãƒ¼å®Œå…¨è§£æ±º
3. **åˆ†é›¢ç’°å¢ƒ**: ãƒ›ã‚¹ãƒˆç’°å¢ƒã«ä¾å­˜ã—ãªã„
4. **è‡ªå‹•è¨­å®š**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å«ã‚ã¦è‡ªå‹•èµ·å‹•

### ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒï¼ˆå¾“æ¥ï¼‰
1. **èµ·å‹•é †åº**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ â†’ Prismaã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ â†’ é–‹ç™ºã‚µãƒ¼ãƒãƒ¼
2. **ç’°å¢ƒå¤‰æ•°**: `.env.local`ã§ç®¡ç†ã€å®Ÿãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æ¥ç¶š
3. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: Docker Composeã§ç®¡ç†ã€ãƒ­ãƒ¼ã‚«ãƒ«å°‚ç”¨
4. **ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç†**: Yarnä½¿ç”¨ï¼ˆnpm ã‹ã‚‰ç§»è¡Œæ¸ˆã¿ï¼‰

---

**ğŸ’¡ æ¨å¥¨**: Jest Workerã‚¨ãƒ©ãƒ¼ãŒå®Œå…¨ã«è§£æ±ºã•ã‚ŒãŸDockerç’°å¢ƒï¼ˆ`yarn docker:dev`ï¼‰ã§ã®é–‹ç™ºã‚’ãŠå‹§ã‚ã—ã¾ã™ï¼
